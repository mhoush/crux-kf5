# Description: Color management framework for visual effects and animation
# URL: http://opencolorio.org
# Maintainer: Tsaop, leeroy at cock dot li
# Depends on: cmake git lcms2 tinyxml

# TODO: Enable building with system yaml-cpp when version 0.6.0 is supported.

name=opencolorio
version=1.1.0
release=3
source=(https://github.com/imageworks/OpenColorIO/archive/v$version.tar.gz)

build() {
	cd OpenColorIO-$version

	# Remove -Werror, as it fails to build otherwise:
	sed -i 's|-Werror||' src/pyglue/CMakeLists.txt
	sed -i 's|-Werror||' src/core/CMakeLists.txt

	mkdir build; cd build

	cmake -DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DOCIO_BUILD_SHARED=ON \
		-DOCIO_BUILD_STATIC=OFF \
		-DOCIO_BUILD_TESTS=OFF \
		-DUSE_EXTERNAL_TINYXML=ON \
		-DUSE_EXTERNAL_YAML=OFF \
		-DUSE_EXTERNAL_LCMS=ON \
		..
	make
	make DESTDIR=$PKG install

	# Move stuff around...
	install -dm755 $PKG/usr/lib/cmake/OpenColorIO
	mv $PKG/usr/cmake/* $PKG/usr/lib/cmake/OpenColorIO
	rmdir $PKG/usr/cmake
	mv $PKG/usr/OpenColorIOConfig.cmake $PKG/usr/lib/cmake/OpenColorIO
	
	# Fix path in .cmake file
	sed -i 's|/cmake/OpenColorIO.cmake|/lib/cmake/OpenColorIO/OpenColorIO.cmake|' $PKG/usr/lib/cmake/OpenColorIO/OpenColorIOConfig.cmake
}
